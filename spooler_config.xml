<?xml version="1.0" encoding="iso-8859-1"?>

<!-- $Id: spooler_config.xml,v 1.4 2001/01/03 11:28:21 jz Exp $   (C) 2000 SOS GmbH Berlin -->

<!DOCTYPE spooler_config SYSTEM "spooler_config.dtd">

<spooler_config>

    <try_start_job_period>5</try_start_job_period>

    <object_set_classes>
        <object_set_class name="Dokumente">
            <level_decls>
                <level_decl>
                    <level>100</level>
                    <level_description>Beauftragt</level_description>
                </level_decl>
                <level_decl>
                    <level>200</level>
                    <level_description>Aufbereitet</level_description>
                </level_decl>
                <level_decl>
                    <level>300</level>
                    <level_description>Gedruckt</level_description>
                </level_decl>
            </level_decls>
            <script><![CDATA[

dir_name = "c:\tmp\spooler"
set fso = createobject( "Scripting.FileSystemObject" )

set log_file = createobject( "hostware.file" )
log_file.open "-out /dev/stderr"

sub log( text )
    log_file.put_line text
end sub


class Testobjekt

    sub construct( file_par )
        dim lev
        set file = file_par
        lev = mid( file.name, instr( file.name & "-", "-" ) + 1 )
        lev = left( lev, instr( lev & ".", "." ) - 1 )
        level = lev
    end sub


    sub process( new_level )
        log "process " & level & " ==> " & new_level 
        'file.name = new_level & ".object"
        file.move dir_name & "\" & new_level & "\" & file.name
        level = new_level
    end sub


    public level

    private file

end class


class Object_set_class

    sub spooler_open()
        dim files
        dim file
        dim i
        
        set files=fso.getFolder(dir_name).Files
        
        file_array = Array
        i = 1
        for each file in files
            redim preserve file_array(i)
            set file_array(i) = file
            i = i + 1
        next 

        index = 1
    end sub


    sub spooler_close()
    end sub


    function spooler_get()
        if spooler_eof then exit function

        dim object
        set object = new Testobjekt
        object.construct file_array(index)
        log "index=" & index & ", level=" & object.level
        index = index + 1

        set spooler_get = object
    end function


    property get spooler_eof()
        spooler_eof = index > ubound(file_array)
    end property


    public low_level
    public high_level

    private file_array
    private index
end class




function spooler_make_object_set
    set object_set = new Object_set_class
    set spooler_make_object_set = object_set
end function

            ]]></script>
        </object_set_class>
    </object_set_classes>

    <jobs>
        <job name="Aufbereiten">
            <object_set>
                <object_set_class.name>Dokumente</object_set_class.name>
                <levels>
                    <low_level><level>100</level></low_level>
                    <high_level><level>200</level></high_level>
                </levels>
            </object_set>
            <output_level><level>200</level></output_level>
            <start_time>
                <time>14:56:55</time>
                <date>2001-01-02</date>
                <date>2001-01-09</date>
                <weekdays>
                    <day>1</day>
                    <day>2</day>
                    <day>3</day>
                </weekdays>
                <monthdays>
                    <day>2</day>
                    <day>3</day>
                </monthdays>
                <ultimos>
                    <day>0</day>
                    <day>1</day>
                </ultimos>
                <holiday>2001-01-03</holiday>
                <duration>3600</duration>
                <period>86400</period>
            </start_time>
        </job>
    </jobs>

</spooler_config>

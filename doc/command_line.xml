<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="scheduler.xsl" type="text/xsl"?>

<!--$Id$-->

<command_line program  = "scheduler"
              title    = "Kommandozeilenoptionen"
              base_dir = ""
              author   = "$Author$"
              date     = "$Date$">

    <command_options name="run" title="Start des Schedulers">
        <description>
            <p>
                Der Programmdateiname <code>scheduler</code> muss absolut und vollständig angegeben werden.
                In Windows mit der Endung "<code>.exe</code>"
                (warum? weil der Scheduler den vollständigen Dateinamen braucht, um einen Job oder sich selbst neu zu starten).
            </p>
        </description>

        <command_option name="config" setting="config">
            <description>
                <p>
                    "<code>-config=</code>" vor dem Dateinamen kann weggelassen werden.
                </p>
            </description>
        </command_option>


        <command_option name="log" setting="scheduler_log"/>
        
        <command_option name="log-dir" setting="log_dir"/>


        <command_option name="id" setting="option_id"/>

        <command_option name="cd" setting="directory"/>

        <command_option name="pid-file" type="dateiname" title="Dateiname für Prozess-Id">
            <description>
                <p>
                    Für Unix:
                    In diese Datei schreibt der Scheduler seine Pid.
                    Beim Beenden löscht der Scheduler die Datei.
                </p>
            </description>
        </command_option>


        <command_option name="log-level"    setting="log_level"/>
        <command_option name="param"        setting="param"/>
        <command_option name="include-path" setting="include_path"/>
        <command_option name="port"         setting="port">
            <description>
                <p>
                    Siehe auch <scheduler_option name="tcp-port"/> 
                    und <scheduler_option name="udp-port"/>.
                </p>
                <p>
                    Wenn der Port blockiert ist, versucht der Scheduler zwei Minuten lang, ihn zu belegen, bevor er aufgibt.
                </p>
            </description>
        </command_option>
        
        <command_option name="tcp-port"     setting="tcp_port">
            <description>
                <p>
                    Siehe auch <scheduler_option name="port"/>.
                </p>
            </description>
        </command_option>
        
        <command_option name="udp-port"     setting="udp_port">
            <description>
                <p>
                    Siehe auch <scheduler_option name="port"/>.
                </p>
            </description>
        </command_option>

        <command_option name="ip-address"   setting="ip_address"/>

        <command_option name="reuse-port" title="TCP- und UDP-Port wiederverwenden (im Notfall)">
            <description>
                <p>
                    Die Option sollte nicht benutzt werden.
                </p>
                <p>
                    Ruft <code>setsockopt(socket,SOL_SOCKET,SO_REUSEADDR,true)</code>.
                </p>
                <p>
		    Die Option sollte <span style="text-decoration: underline">nur im Notfall</span> benutzt werden,
		    falls das Betriebssystem den Port dauerhaft sperrt,
		    obwohl keine Anwendung ihn mehr belegt.
		    Das kann unter Windows XP passieren, wenn die Anwendung mit einem Debugger abgebrochen wird.
		    Suse 8.0 kann fast eine Minute brauchen, um einen Port freizugeben.
                </p>
                <p>
		    U.U. ist der Scheduler mit <code>-reuse-port</code> über TCP oder UDP nicht erreichbar,
		    weil statt dessen der Port der anderen Anwendung angesprochen wird.
                </p>
            </description>
        </command_option>


        <command_option name="cmd" type="xmlkommando" title="Sofort auszuführendes Kommando">
            <description>
                <p>
                    Der Scheduler führt beim Start das XML-Kommando aus.
                    Das kann z.B. ein <scheduler_element name="start_job"/> sein.
                </p>
            </description>
        </command_option>


        <command_option name="ini" type="dateiname" title="Anderer Name für Datei factory.ini">
            <description>
                <p>
                    Wählt eine andere Datei für die Datei <a href="factory_ini.xml"><code>factory.ini</code></a> aus.
                </p>
                <p>
                    In dieser Dokumentation ist dann mit der Datei <code>factory.ini</code> die hier eingestellte gemeint.
                </p>
                <p>
                    Siehe auch <scheduler_method class="Spooler" property="ini_path"/>
                </p>
            </description>
        </command_option>


        <command_option name="sos.ini" type="dateiname" title="Anderer Name für Datei sos.ini">>
            <description>
                <p>
                    Wählt eine andere Datei für die Hostware-Konfiguration <a href="sos_ini.xml"><code>sos.ini</code></a> aus.
                    Diese Datei enthält u.a. den Lizenzschlüssel.
                </p>
            </description>
        </command_option>


        <command_option name="program-file" type="dateiname" title="Dateiname des Schedulers">
            <description>
                <p>
                    Beim Aufruf des Schedulers aus einer Java-Klasse heraus (zum Debuggen)
                    geben Sie hier den Programmdateinamen an,
                    wenn der Scheduler Jobs in eigenen Prozessen starten können soll.
                </p>
            </description>
        </command_option>


        <command_option name="service" title="Als Daemon starten">
            <description>
                <p>
                    Unter Unix versetzt sich der Scheduler in den Hintergrund und trennt sich vom Terminal.
                    stdout und stderr sollten in eine Datei umgeleitet werden, damit Ausgaben nicht verloren gehen.
                </p>
            </description>
        </command_option>


<!-- funktioniert nicht 2005-01-22
        <command_option name="renew-service" type="name" title="Windows-Dienst entfernen und erneut installieren">
            <description>
                <scheduler_keyword keyword="Service"/>
                <scheduler_keyword keyword="Dienst"/>
                <p>
                    <code>-renew-service=</code><i>name</i> ist dasselbe wie
                    <code>-renew-service -service-name=</code><i>name</i>.
                </p>
            </description>
        </command_option>
-->

        <command_option name="validate-xml" title="XML-Dokumente gegen eingebettetes Schema validieren">
            <description>
                <p>
                    <code>-validate-xml-</code> schaltet die Validierung ab 
                    (für den Fall, dass das Schema fehlerhaft ist).
                </p>
                <p>
                    Siehe <scheduler_option name="show-xml-schema"/>.
                </p>
            </description>
        </command_option>


        <command_option name="env" multiple="yes" type="name=value" title="Umgebungsvariable setzen">
            <description>
                <p>
                    <code>-env=NAME=VALUE</code> setzt die Umgebungsvariable NAME.
                </p>
            </description>
            <messages>
                <message level="error" code="SCHEDULER-318"/>
            </messages>
        </command_option>


        <command_option name="heart-beat" title="Startet den Scheduler mit Herzschlag für backup-fähigen Betrieb">
            <description>
                <p>
                    Der Backup-Scheduler beobachtet einen mit
                    <scheduler_option name="heart-beat"/>
                    gestarteten Scheduler.
                </p>
            </description>
        </command_option>


        <command_option name="backup" title="Startet den Scheduler als Backup-Scheduler">
            <description>
                <p>
                    
                </p>
                <p>
                    Der Backup-Scheduler beobachtet über die Datenbank einen mit
                    <scheduler_option name="heart-beat"/> 
                    und gleicher Konfiguration, insbesondere <scheduler_option name="id"/>,
                    gestarteten Scheduler.
                </p>
                <p>
                    
                </p>
            </description>
        </command_option>


        <example>
            <pre>c:\bin\scheduler.exe c:\scheduler\config.xml -log-dir=c:\scheduler\logs</pre>
        </example>
    </command_options>

    

    <command_options name="install_service" title="Installation eines Windows-Dienstes">
        <command_option name="install-service" type="name" title="Als Windows-Dienst installieren">
            <description>
                <scheduler_keyword keyword="Service"/>
                <scheduler_keyword keyword="Dienst"/>
                <p>
                    Die Option startet nicht den Scheduler,
                    sondern installiert ihn als Windows-Dienst.
                    Dabei werden folgende Optionen aus der Kommandozeile übernommen:
                </p>
                <p>
                    <scheduler_option name="cd"/>
                    <br/>
                    <scheduler_option name="config"/>
                    <br/>
                    <scheduler_option name="id"/>
                    <br/>
                    <scheduler_option name="ini"/>
                    <br/>
                    <scheduler_option name="log"/>
                    <br/>
                    <scheduler_option name="pid-file"/>
                    <br/>
                    <scheduler_option name="sos.ini"/>
                    <br/>
                    <scheduler_option name="env"/>
                    <br/>
                </p>
                <p>
                    <code>-install-service=</code><i>name</i> ist dasselbe wie
                    <code>-install-service -service-name=</code><i>name</i>.
                </p>
            </description>
        </command_option>

        <command_option name="remove-service" type="name" title="Windows-Dienst entfernen">
            <description>
                <scheduler_keyword keyword="Service"/>
                <scheduler_keyword keyword="Dienst"/>
                <p>
                    Entfernt einen zuvor mit <code>-install-service</code> installierten Dienst.
                </p>
                <p>
                    <code>-remove-service=</code><i>name</i> ist dasselbe wie
                    <code>-remove-service -service-name=</code><i>name</i>.
                </p>
            </description>
        </command_option>

        <command_option name="service-name" type="name" initial="sos_scheduler" title="Interner Name des Windows-Dienstes">
            <description>
                <p>
                    Nur in Verbindung mit <code>-install-service</code> oder <code>-remove-service</code>.
                    Wenn diese Option fehlt und <code>-id=</code> angegeben ist,
                    verwendet der Scheduler den Namen <code>sos_scheduler_</code><i>scheduler_id</i>.
                </p>
            </description>
        </command_option>


        <command_option name="service-display" type="text" title="Angezeigter Name des Windows-Dienstes">
            <description>
                <p>
                    Nur in Verbindung mit <code>-install-service</code>.
                    Die Dienstesteuerung von Windows zeigt diesen Namen.
                    Er darf Leerzeichen enthalten.
                    Wenn die Option fehlt, erzeugt der Scheduler einen aus dem Dienstnamen (s. <code>-service-name=</code>).
                </p>
            </description>
        </command_option>


        <command_option name="service-descr" type="text" title="Beschreibung des Windows-Dienstes">
            <description>
                <p>
                    Nur in Verbindung mit <code>-install-service</code>.
                </p>
            </description>
        </command_option>


        <command_option name="need-service" type="name" title="Vom Scheduler vorausgesetzter Dienst">
            <description>
                <p>
                    In Verbindung mit <code>-install-service</code> können Sie hier einen anderen Dienst angegeben,
                    der laufen soll, bevor Windows den Scheduler-Dienst startet.
                    Das kann z.B. ein Datenbank-Server sein.
                </p>
                <p>
                    Diese Option kann wiederholt angegeben werden, wenn der Scheduler mehrere Dienste voraussetzt.
                </p>
            </description>
        </command_option>

    </command_options>


    
    <command_options name="start_job" title="Laufendem Scheduler einen Job übergeben">

        <command_option name="scheduler" type="host:port" title="TCP-Adresse des Schedulers">
            <description>
                <p>
                    Rechnername (oder IP-Nummer) und Portnummer des anzusprechenden Schedulers.
                </p>
            </description>
        </command_option>

        <command_option name="log" setting="scheduler_log" reference="yes"/>

        <command_option name="process-class" type="name">
            <description>
                <p>
                    Name der Prozessklasse für den temporären Job,
                    siehe <scheduler_element name="job" attribute="process_class"/>.
                </p>
            </description>
        </command_option>

        <command_option name="language" type="script_language" initial="shell" title="Skriptsprache des Jobs">
            <description>
                <p>
                    Skriptsprache,
                    siehe <scheduler_element name="script" attribute="language"/>.
                </p>
            </description>
        </command_option>

        <command_option name="at" type="yyyy-mm-dd HH:MM" initial="now" title="Startzeitpunkt">
            <description>
                <p>
                    Startzeitpunkt in der Form "yyyy-mm-dd HH:MM[:SS]".
                    Siehe <scheduler_element name="at" attribute="at"/>.
                </p>
                <p>
                    Der Job wird nicht gestartet, wenn der Startzeitpunkt in der Vergangenheit liegt.
                </p>
                <p>
                    Maßgeblich ist die Uhr des Rechners, auf dem der Scheduler läuft.
                </p>
                <p>
                    <code>-at=now</code> ist voreingestellt und lässt den Job sofort starten.
                </p>
            </description>
        </command_option>

        <description>
            <p>
                Dem mit <scheduler_option name="scheduler" value="host:port"/> adressierten Scheduler
                wird ein temporärer Job übergeben.
            </p>
            <p>
                Bei einem Neustart des Schedulers geht der Job verloren.                
            </p>
        </description>

        <example>
            <pre>echo ls -l | scheduler -scheduler=localhost:4444 -at="2006-04-04 12:00"</pre>
        </example>
    </command_options>


    
    <command_options name="add_order" title="Laufendem Scheduler einen Auftrag übergeben">
        <command_option name="scheduler" reference="yes"/>
        <command_option name="log" reference="yes"/>

        <command_option name="job-chain" type="name" title="Jobkette">
            <description>
                <p>
                    Name der Jobkette für den Auftrag,
                    siehe <scheduler_element name="add_order" attribute="job_chain"/>.
                </p>
            </description>
        </command_option>

        <command_option name="order-id" type="id" title="Kennung des Auftrags">
            <description>
                <p>
                    Kennung des Auftrags,
                    siehe <scheduler_element name="add_order" attribute="id"/>.
                </p>
            </description>
        </command_option>

        <command_option name="title" type="text" title="Titel des Auftrags">
            <description>
                <p>
                    Dem Auftrag kann ein Titel gegeben werden.
                    Siehe <scheduler_element name="add_order" attribute="title"/>.
                </p>
            </description>
        </command_option>

        <description>
            <p>
                Dem mit <scheduler_option name="scheduler" value="host:port"/> adressierten Scheduler
                wird ein Auftrag übergeben.
            </p>
            <p>
                Die Parameter des Auftrags (s. <scheduler_method class="Order" property="payload"/>) können
                an der Kommandozeile in der Form <i>name</i><code>=</code><i>value</i> übergeben werden.
            </p>
        </description>

        <example>
            <pre>scheduler -scheduler=localhost:4444 -job-chain=my_job_chain -order-id=123 city=Berlin phone="+4930 864790-0" </pre>
        </example>
    </command_options>    

    <command_options name="send_cmd" title="XML-Kommando an laufenden Scheduler übergeben">
        <command_option name="tcp-port" reference="yes"/>

        <command_option name="send-cmd" type="xmlkommando" title="Anderem Scheduler zu schickendes Kommando">
            <description>
                <p>
                    Mit dieser Option startet der Scheduler nicht,
                    sondern schickt einem anderen Scheduler mit gleicher Option <code>-tcp-port=</code>
                    auf demselben Rechner das XML-Kommando.
                    Das kann z.B. ein <scheduler_element name="terminate"/> sein: <code>-send-cmd="&lt;terminate/>"</code>
                </p>
            </description>
        </command_option>
    </command_options>

    

    <command_options name="kill" title="Laufenden Scheduler mit kill abbrechen">
        <command_option name="kill" title="Laufenden Scheduler mit kill abbrechen">
            <description>
                <p>
                    Bricht den Scheduler mit <code>kill&#160;-SIGKILL</code> ab, 
                    dessen Prozess-Id in der mit <scheduler_option name="pid-file"/> angegebenen Datei steht.
                </p>
            </description>
        </command_option>

        <command_option name="kill" type="pid" title="Laufenden Scheduler mit kill abbrechen">
            <description>
                <p>
                    Bricht den Prozess mit der Pid mit <code>kill&#160;-SIGKILL</code> ab.
                </p>
            </description>
        </command_option>

        <command_option name="pid-file" type="dateiname" reference="yes"/>

        <example>
            <pre>scheduler -kill -pid-file=/home/scheduler/scheduler.pid</pre>
        </example>
    </command_options>

    

    <command_options name="xml_schema" title="XML-Schema zeigen">
        <command_option name="show-xml-schema" title="schreibt das XML-Schema nach stdout">
            <description>
                <p>
                    Der Scheduler hat ein XML-Schema,
                    dem die XML-Kommandos und die XML-Konfiguration entsprechen müssen.
                </p>
                <p>
                    Siehe <a href="xml/scheduler.xsd" type="text/plain" charset="utf-8">XML-Schema des Schedulers</a>.
                </p>
            </description>
        </command_option>

        <example>
            <pre>scheduler -show-xml-schema | less</pre>
        </example>
    </command_options>

    
    <command_options name="classpath" title="Java-Classpath expandieren">
        <command_option name="expand-classpath" title="Java-Classpath expandieren">
            <description>
                <p>
                    Expandiert den als Parameter angegebenen Java-Classpath,
                    d.h. die Joker werden verarbeitet wie <scheduler_ini_entry file="sos.ini" section="java" entry="class_path"/>.
                </p>
                <p>
                    Das Ergebnis schreibt der Scheduler nach <code>stdout</code>.
                    Wenn keine weiteren Optionen es verlangen, beendet sich der Scheduler ohne weitere Ausgaben.
                </p>
            </description>
            <example>
                <pre>export CLASSPATH="`scheduler -expand-classpath='/opt/java/lib/*.jar'`"</pre>
            </example>
        </command_option>
    </command_options>

    
    <command_options name="version" title="Versionsnummer zeigen">
        <command_option name="V" title="Versionsnummer zeigen">
            <description>
                <p>
                    Lässt den Scheduler beim Start Versionsnummer und Versionsdatum ausgeben.
                </p>
            </description>
        </command_option>
    </command_options>

    
    <description>
        <p>
            Der Scheduler wird durch einfachen Aufruf gestartet.
        </p>
        <pre>C:\>…<i>installation path</i>…\scheduler.exe …\my_scheduler_configuration.xml …</pre>
        <pre>user@host:~> …<i>installation path</i>…/scheduler …/my_scheduler_configuration.xml …</pre>
        <p>
            In der Regel müssen vorher noch einige Umgebungsvariablen gesetzt sein,
            siehe das Handbuch »Installation und Konfiguration«.

            <!-- TODO Welche? Das sollte hier kurz aufgeführt werden und steht jetzt sicher ausführlich in einer Installationsbeschreibung.
                 Pfad für JVM, javac, libstdc++, libspidermonkey.so, libjavascript.so -->
        </p>
        <p>
            Die Parameter (rechts vom Gleichheitszeichen) 
            der hier beschriebenen Kommandozeilenoptionen
            können in Anführungszeichen oder in Apostrophe
            gesetzt werden.
        </p>
    </description>

    <scheduler_keyword keyword="Kommandozeile"/>
    <scheduler_keyword keyword="Optionen"/>

</command_line>

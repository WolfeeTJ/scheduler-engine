<html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="ProgId" content="FrontPage.Editor.Document">
<style type="text/css">
h1           { font-size: 24pt; font-weight: bold; margin-bottom: 4ex;  }
h2           { font-size: 12pt; font-weight: bold; margin-top: 10ex; }
h3           { font-size: 10pt; font-weight: bold; margin-top: 6ex }
.zwischentitel { font-weight: bold; margin-top: 6ex }
td           { font-size: 10pt; margin-top: 2ex; margin-bottom: 0  }
p            { font-size: 10pt; margin-top: 2ex; margin-bottom: 0  }
li           { font-size: 10pt }
pre          { font-family: Lucida Console, monospace; font-size: 9pt; margin-left: 4ex; line-height: 1.2em; }
.indent      { margin-left: 4ex; }
.mono        { font-family: Lucida Console, monospace; font-size: 9pt }
</style>

<title>Spooler mit Java</title>
</head>
<body>



<h1>Spooler mit Java</h1>

<p align="right">13. November&nbsp; 2002</p>

<h2>Voraussetzungen</h2>
<p class="zwischentitel">Java Virtual Machine</p>
<p>Empfohlen wird die Java VM von Sun, ab Version 1.4.0_01 (<a href="http://java.sun.com">java.sun.com</a>).</p>
<p>Die Java VM von Microsoft ist nicht geeignet.&nbsp;</p>
<p>Der Dateiname der Java VM ist in die Datei <font class="mono">factory.ini</font>
einzutragen, z.B.:</p>
<pre>[java]
vm = C:\Programme\Java\j2re1.4.0_01\bin\client\jvm.dll</pre>
<p>Wenn der Spooler die Java VM nicht starten kann, gibt er eine Meldung ins
Protokoll und startet ohne Java-Jobs.</p>
<p class="zwischentitel">Java Compiler</p>
<p>Den Compiler brauchen Sie zum Compilieren der Jobs. Der Spooler erwartet
compilierte Jobs (.class-Dateien).</p>
<p>Z.B. Borland JBuilder ab Version 5.</p>
<h2>Besonderheiten</h2>
<p>Beim Reload (<font class="mono">&lt;modify_spooler cmd=&quot;reload&quot;&gt;</font>)
entlädt der Spooler nicht die Java VM (Suns Java VM verträgt das nicht.)</p>
<p class="zwischentitel">Spooler-Klassen</p>
<p>Der Datentyp VARIANT in der COM-Klassen ist in den Java-Klassen durch String
ersetzt. Das gilt u.a. für</p>
<pre><font class="mono">Spooler.var</font></pre>
<pre>Task.result
Task.history_field</pre>
<pre>Variable_set.set_var
Variable_set.var</pre>
<pre>Order.id
Order.state</pre>
<p><font class="mono">Order.payload</font> kann nur <font class="mono">java.lang.Objec</font>t
aufnehmen. Die Eigenschaft ist damit nicht mit Job anderer Sprachen austauschbar
(wäre aber realisierbar).</p>
<p>Nicht implementiert sind u.a.</p>
<pre>Object_set
Spooler.script
Thread.script
Variable_set.dom</pre>
<h2>Vom Spooler bereitgestellte Klassen</h2>
<p>Die Java-Klassen des Spooler werden in der Datei <font class="mono">sos.spooler.jar</font>
ausgeliefert. <a href="../java">Dokumentation ist hier</a>.</p>
<h2>Wie schreibe ich einen Job?</h2>
<p>Ein in Java geschriebener Job wird als Java-Klasse, die von <font class="mono"><a href="../java/sos/spooler/Job_impl.html">sos.spooler.Job_impl</a></font>
erbt, implementiert. Die Klasse stellt die gewohnten Methoden spooler_open(),
spooler_process() usw. bereit.</p>
<h2>Beispiel</h2>
<h3>factory.ini</h3>
<p>Hier wird der Dateiname der Java Virtual Machine angegeben.&nbsp;</p>
<pre>[java]
vm = C:\Programme\Java\j2re1.4.0_01\bin\client\jvm.dll</pre>
<h3>Spooler-Datei</h3>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
&lt;!DOCTYPE spooler SYSTEM &quot;http://www.zsch.de/2002/spooler-1.2.dtd&quot;&gt;

&lt;spooler&gt;
  &lt;config <b>java_class_path=&quot;</b>...<b>/classes&quot;</b>&gt;
    &lt;threads&gt;
      &lt;thread name = &quot;faden1&quot;&gt;
        &lt;jobs&gt;

          &lt;job name=&quot;java&quot;&gt;
            &lt;script <b>java_class=&quot;spooler_job.Test&quot;</b>/&gt;
            &lt;run_time once=&quot;yes&quot;/&gt;
          &lt;/job&gt;

          &lt;job name=&quot;Order_job&quot; order=&quot;yes&quot;&gt;
             &lt;script <b>java_class=&quot;spooler_job.Order_job&quot;</b>/&gt;
             &lt;run_time/&gt;
          &lt;/job&gt;

        &lt;/jobs&gt;
      &lt;/thread&gt;
    &lt;/threads&gt;
  &lt;/config&gt;
&lt;/spooler&gt;</pre>
<h3>Java-Klasse&nbsp; spooler_job.Test</h3>
<pre>package spooler_job;

import sos.spooler.*;

public class Test extends sos.spooler.Job_impl
{

    public boolean spooler_open()
    {
        spooler_log.info( &quot;Hallo, hier ist Java spooler_open&quot; );
        spooler.set_var( &quot;var1&quot;, &quot;Java&quot; );

        Job_chain job_chain = spooler.create_job_chain();
        job_chain.set_name( &quot;Jobkette&quot; );
        job_chain.add_job( &quot;Order_job&quot;, &quot;100&quot;, &quot;200&quot;, &quot;&quot; );
        job_chain.add_end_state( &quot;200&quot; );
        spooler.add_job_chain( job_chain );

        Order order = spooler.create_order();
        order.set_id( &quot;Kennung&quot; );
        order.set_title( &quot;Auftragstitel&quot; );
        order.set_payload( new Integer(7) );
        order.set_priority( 3 );

        job_chain.add_order( order );

        return true;
    }
}</pre>
<h3>Java-Klasse&nbsp; spooler_job.Order_job</h3>
<pre>package spooler_job;

import sos.spooler.*;

public class Order_job extends sos.spooler.Job_impl
{
    public boolean spooler_process()
    {
        spooler_log.info( &quot;Und hier ist spooler_process&quot; );
        spooler_log.info( &quot;var1=&quot; + spooler.var(&quot;var1&quot;) );

        Order order = spooler_task.order();
        spooler_log.info( &quot;Auftrag id=&quot; + order.id() + &quot; title=&quot; + order.title() + &quot; payload=&quot; + order.payload() );

        return true;
    }
}</pre>

<p>&nbsp;
</p>

<HR SIZE=1>
<FONT face="Arial" size="2">Dipl.-Inform. Joacim Zschimmer&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<A href="mailto:j@zsch.de">j@zsch.de</A>
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;(030) 3470 2520&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Zschimmer GmbH</FONT>

</body>

</html>
